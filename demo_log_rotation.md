# 日志轮转和备份演示指南

## 日志功能特性

### 1. 自动日志轮转
- **文件大小限制**：100MB
- **轮转机制**：当日志文件达到100MB时自动轮转
- **备份命名**：`processmonitor.log.2025-06-05_16-12-35`

### 2. 定期清理
- **清理周期**：每月第一天自动清理
- **保留期限**：保留最近1个月的日志文件
- **自动删除**：超过1个月的备份文件会被自动删除

### 3. 日志输出
- **双重输出**：同时输出到控制台和文件
- **实时显示**：控制台实时显示日志信息
- **持久保存**：所有日志保存到文件中

## 测试日志轮转

### 方法1：模拟大量日志
```bash
# 运行监控程序并生成大量日志
.\processmonitor.exe -config config.yaml

# 可以通过频繁重启被监控进程来生成更多日志
# 或者修改check_interval为更小的值（如1秒）
```

### 方法2：手动测试轮转
可以临时修改代码中的maxSize值来测试：
```go
// 将100MB改为1MB进行测试
logRotator := NewLogRotator("processmonitor.log", 1*1024*1024) // 1MB
```

## 日志文件结构

### 当前日志文件
- `processmonitor.log` - 当前活跃的日志文件

### 备份日志文件
- `processmonitor.log.2025-06-05_16-12-35` - 轮转后的备份文件
- `processmonitor.log.2025-06-04_10-30-22` - 更早的备份文件
- ...

## 日志轮转行为

### 轮转触发条件
1. 当前日志文件大小 + 新日志内容 > 100MB
2. 自动创建备份文件
3. 重新创建新的日志文件

### 轮转过程
1. 关闭当前日志文件
2. 重命名为带时间戳的备份文件
3. 创建新的日志文件
4. 记录轮转信息

### 月度清理过程
1. 每天检查是否为月初（第1天）
2. 扫描日志目录中的所有备份文件
3. 删除修改时间超过1个月的文件
4. 记录清理操作

## 配置说明

### 日志轮转配置
```go
// 在main.go中的配置
logRotator := NewLogRotator("processmonitor.log", 100*1024*1024) // 100MB

// 可以根据需要调整：
// 50MB: 50*1024*1024
// 200MB: 200*1024*1024
// 1GB: 1024*1024*1024
```

### 清理周期配置
```go
// 当前配置：每天检查，月初清理
ticker := time.NewTicker(24 * time.Hour)

// 可以调整为：
// 每小时检查: time.NewTicker(1 * time.Hour)
// 每周检查: time.NewTicker(7 * 24 * time.Hour)
```

### 保留期限配置
```go
// 当前配置：保留1个月
cutoff := time.Now().AddDate(0, -1, 0) // 1个月前

// 可以调整为：
// 保留3个月: time.Now().AddDate(0, -3, 0)
// 保留1年: time.Now().AddDate(-1, 0, 0)
```

## 监控日志状态

### 查看当前日志文件大小
```bash
# Windows
dir processmonitor.log

# Linux
ls -lh processmonitor.log
```

### 查看所有日志文件
```bash
# Windows
dir processmonitor.log*

# Linux
ls -lh processmonitor.log*
```

### 查看日志内容
```bash
# 查看当前日志
type processmonitor.log

# 查看备份日志
type processmonitor.log.2025-06-05_16-12-35
```

## 注意事项

1. **磁盘空间**：确保有足够磁盘空间存储日志文件
2. **权限问题**：确保程序有权限创建和删除日志文件
3. **并发安全**：日志轮转过程是线程安全的
4. **性能影响**：日志轮转时会有短暂的I/O操作
5. **备份策略**：重要的日志文件建议额外备份到其他位置

## 故障排除

### 日志文件无法创建
- 检查目录权限
- 确保磁盘空间充足
- 检查文件是否被其他程序占用

### 轮转失败
- 查看错误日志信息
- 检查文件权限
- 确保目标目录可写

### 清理失败
- 检查文件权限
- 确保文件未被占用
- 查看具体错误信息